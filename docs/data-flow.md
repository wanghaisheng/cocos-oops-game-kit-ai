# 数据流文档

## 概述

本文档描述了基于OOPS Framework的游戏项目中数据的流转过程，包括数据的加载、处理、存储和同步机制。

## 数据流转图

```
用户操作 → UI事件 → System处理 → Component数据更新 → UI更新
  ↑                                      ↓
  └──────────── 数据持久化 ←─────────────┘
```

## 核心数据流程

### 1. 初始化数据流

1. **游戏启动**: Main.ts作为入口点初始化游戏
2. **配置加载**: 从resources/config.json加载基础配置
3. **资源预加载**: 加载必要的游戏资源
4. **用户数据初始化**: 加载用户账号和游戏进度数据

### 2. 游戏内数据流

1. **用户输入**: 用户在UI上的操作触发事件
2. **事件分发**: 事件被分发到对应的System进行处理
3. **数据处理**: System处理逻辑并更新Component中的数据
4. **UI更新**: 数据变化触发UI组件更新

### 3. 数据持久化

1. **本地存储**: 游戏数据通过LocalStorage或IndexedDB存储在本地
2. **云端同步**: 重要数据可选择性地同步到云端服务器
3. **存储时机**: 在关键节点（如关卡完成、设置更改）自动保存数据

## 数据模块说明

### 账号数据 (AccountModelComp)

账号模块管理用户身份和基本信息，包括：

- 用户ID和基本信息
- 登录状态管理
- 账号数据的加载和保存

### 游戏进度数据

记录用户在游戏中的进度信息，包括：

- 已完成的关卡
- 获得的成就
- 游戏内资源（金币、道具等）

### 配置数据

从配置文件加载的静态数据，包括：

- 游戏参数配置
- 关卡设计数据
- 物品属性数据

## 数据通信

### 本地数据通信

在ECS架构中，数据通信主要通过以下方式实现：

1. **直接访问**: System可以直接访问和修改Component中的数据
2. **事件机制**: 通过事件系统在不同模块间传递数据和消息
3. **响应式更新**: 数据变化自动触发UI更新

### 网络数据通信

对于联网游戏，数据通信还包括：

1. **数据同步**: 客户端与服务器之间的数据同步机制
2. **请求响应**: 客户端发送请求，服务器处理后返回响应
3. **推送通知**: 服务器主动向客户端推送数据更新

## 最佳实践

1. **数据分层**: 将UI数据、业务数据和持久化数据分层管理
2. **单向数据流**: 遵循单向数据流原则，使数据流向清晰可控
3. **数据验证**: 在关键节点进行数据验证，确保数据一致性
4. **错误处理**: 完善的错误处理机制，确保数据异常不会导致游戏崩溃
5. **性能优化**: 避免频繁的数据存取操作，合理使用缓存机制